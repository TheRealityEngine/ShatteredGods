<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>

      .matBox {
        border-radius: 15px;
        background-color: green;
        display: grid;
        grid-template-columns:  240px, 1020px, 240px, 360px;
        grid-template-rows: 240px, 20px, 240px, 20px, 240px, 20px;
        text-align: center;
        font-weight: bold;
      }

      .playBox {
        border-radius: 15px;
        background-color: greenyellow;
        width: 1000px;
        height: 220px;
        margin-left: 20px;
        margin-top: 10px;
        margin-bottom: 0px;
        display: inline-flex;
      }

      .deckBox {
        border-radius: 15px;
        background-color: whitesmoke;
        width: 140px;
        height: 220px;
        margin-left: 20px;
        margin-top: 10px;
        margin-bottom: 0px;
      }

      .emptyBox {
        border-radius: 15px;
        background-color: greenyellow;
        width: 140px;
        height: 220px;
        margin-left: 20px;
        margin-top: 10px;
        margin-bottom: 0px;
      }

      .statBox {
        border-radius: 15px;
        background-color: whitesmoke;
        width: 140px;
        
        margin-left: 20px;
        margin-top: 10px;
        margin-bottom: 0px;
      }

      .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        width: 60px;
        height: 220px;
        border-radius: 15px;
        margin: 5px;
      }
      .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
      }

      .grayout {
        filter: grayscale(100%);
      }
      .ungray {
        filter: grayscale(0%);
      }
      input.attrib {
        width: 30px;
      }
      .num,
      .dots {
        display: inline;
      }
      .aDot,
      .aCir,
      .aBox,
      .fBox {
        width: 1.4em;
        height: 1.4em;
      }
      .stat {
        font-size: 1.4em;
      }
      .col2 {
        float: left;
        min-width:20em;
        padding: 10px;
        box-sizing:border-box;
        width: 48%
      }
    </style>
  </head>
  <body>
      <div id="statButt" style="position:absolute;top:5px; right:10px;z-index:5; display:block;">
        <input type="text" placeholder="copy the text here to save" id="saveField"><button onclick="LoadSave()">Load Save</button><input type="button" onclick="SavingStuff()" value="Save" />
        <button onclick="toggleSheet('open')">Open</button>
      </div>
      <div id="statSheet" style="position:absolute;top:5px; right:10px;z-index:5; display:none; width:65%; background-color:white">
        
        <h3 style="text-align:right;">Character Sheet</h3>
        <div class="col2">
        <p><input class="writing" type="text" id="pcName" placeholder="Name" style="border: 0; font-size: 1.5em"/></p>
        <p class="stat" name="bod">
          <input
            type="number"
            min="1"
            max="5"
            value="1"
            id="bodnum"
            class="attrib"
            oninput="NumberMe('bod'), HealthMax()"
            onchange="HealthMax()"
            style="display: none"
          />
          <b>BODY</b>
          <span id="bodPar">What?</span>
        <p class="stat" name="bru" style="text-indent: 50px;">
          <input
            type="number"
            min="1"
            max="5"
            value="1"
            id="brunum"
            class="attrib"
            oninput="NumberMe('bru')"
            style="display: none"
          />
          <b>Brute</b>
          <span id="bruPar">What?</span>
          <p class="stat" name="swi" style="text-indent: 50px;">
            <input
              type="number"
              min="1"
              max="5"
              value="1"
              id="swinum"
              class="attrib"
              oninput="NumberMe('swi')"
              style="display: none"
            />
            <b>Swift</b>
            <span id="swiPar">What?</span>
            <p class="stat" name="min">
              <input
                type="number"
                min="1"
                max="5"
                value="1"
                id="minnum"
                class="attrib"
                oninput="NumberMe('min')"
                style="display: none"
              />
              <b>MIND</b>
              <span id="minPar">What?</span>
            <p class="stat" name="sma" style="text-indent: 50px;">
              <input
                type="number"
                min="1"
                max="5"
                value="1"
                id="smanum"
                class="attrib"
                oninput="NumberMe('sma')"
                style="display: none"
              />
              <b>Smart</b>
              <span id="smaPar">What?</span>
              <p class="stat" name="cha" style="text-indent: 50px;">
                <input
                  type="number"
                  min="1"
                  max="5"
                  value="1"
                  id="chanum"
                  class="attrib"
                  oninput="NumberMe('cha')"
                  style="display: none"
                />
                <b>Charm</b>
                <span id="chaPar">What?</span>
                <p class="stat" name="hun">
                  <input
                    type="number"
                    min="1"
                    max="10"
                    value="1"
                    id="hunnum"
                    class="attrib"
                    oninput="NumberMe('hun')"
                    style="display: none"
                  />
                  <b>Hunger</b>
                  <span id="hunPar">What?</span>

                  <p><b>Health</b><input type="number" min="0" value="1" id="heanum" class="attrib"/><span id="maxHealth"></span></p>

                  <p><b>Promises</b><input class="sav" id="promnum" type="number" style="width: 40px;" /></p>

                  <p><b>Promise Die</b><select class="sav" id="promdie">
                    <option value="4">d4</option>
                    <option value="6">d6</option>
                    <option value="8">d8</option>
                    <option value="10">d10</option>
                    <option value="12">d12</option>
                    <option value="20">d20</option></select>
                    <button onclick="resolvePromise()">Rest</button></p>
                <br />
                <button onclick="changeDeck()">Update Deck</button>
              </div>
              <div class="col2">
                <p><b><span style="font-size: 1.2em">War Shard</span></b> <select class="sav" id="warshard" onchange="changeWar()">
                  <option></option>
                  <option value="After defeating an enemy- remove 1 Promise">Victory</option>
                  <option value="Spend 1 Body card to add 1 armor to ally in same tile">Protection</option>
                  <option value="Can lose X armor to add X damage">Frenzy</option>
                  <option value="Can swap to any owned weapon as a free action">Weaponry</option>
                  <option value="Add Hunger in damage to structures & items & armor">Destruction</option>
                  <option value="Friendly humans cannot become Aggressive unless they or allies are attacked">Loyalty</option>
                  <option value="Can also spend Smart to add 1 to ally actions">Strategy</option>
                </select>
              
                <span id="warAbility" style="font-size: 0.9em"></span>
              </p>
              <p><b>Trait</b><select class="sav" id="wartrait" onchange="changeWar()">
                <option></option>
                <option value="Add Shard rating to damage but can't retreat with active Hunger">Blood Thirsty</option>
                <option value="Add Shard rating to Charm checks but attitudes worsen by +1">Manipulative</option>
                <option value="Non-aggressive humans start +1 Attitude but add +1 promise to not attack Aggressive humans">Glory-Seeking</option>
                <option value="Add shard rating to picking locks & pockets and when looting. However minus Shard rating to charm checks if they are richer than you.">Envious</option>
              </select>
              <span id="traittext" style="font-size: 0.9em"></span>
            </p>
              <p><b>Minor Shard</b> <input class="writing" id="mshard" type="text" /></p>
              <p><b>Visual Detriment</b> <input class="writing" id="visdet" type="text" /></p>
              <p><b>Minor Bonus</b> <select id="mbon" class="sav">
                <option value="1">+1 Armor</option>
                <option value="2">Unarmed Strike</option>
                <option value="3">+1 to Search</option>
                <option value="4">+1 Speed</option>
                </select>
              </p>
              <p><b><u>Equipment</u></b></p>
              <p><b>Armor</b> Dmg Reduced / Max Swift per Turn</p>
              <p>
              <select class="sav" id="armor">
                <option value="1">Heavy: 3/1</option>
                <option value="2">Medium: 2/2</option>
                <option value="3">Light: 1/3</option>
                <option value="4">None: 0/Infinite</option>
              </select>
              </p>
              <p><b><u>Basic Actions</u></b></p>
              <p><b>Take Cover:</b>Spend Swift to add Cover to armor (Resist: Smart)</p>
              <p><b>Hide:</b>Spend 1 Swift to add Cover to Stealth (Resist: Smart)</p>
              <p><b>Intimidate:</b>Spend Charm to trash an Attack(Resist: Smart)</p>
              <p><b>Bolster:</b>Spend Charm to add +1 to Ally action</p>
              <p><b>Dodge:</b>Spend Swift to add Armor</p>
              <p><b>Run:</b>Spend Swift to move through terrain</p>
              <br />
              <p><u>Skill Cards</u>: Discard any 2 cards to move a Skill card to the Trash or Discard Pile. Discard any 3 cards to move it directly to your hand.</p>
              </div>
        <p id="infoBox" style="
        padding: 5px; overflow: scroll;"></p>
        <button style="float:right;" onclick="toggleSheet('close')">Close</button>
        </div>
    <div class="matBox" id="mattBoxx">
      <div class="deckBox" id="tradedDeck" style="grid-row: 1" draggable="true" ondrag="drag(event, 0, 'traded')">
        <p>Skill Deck</p>
      </div>
      <div
        class="playBox"
        id="traderArea"
        style="grid-row: 1"
        ondrop="drop(event, 'trader', trader)"
        ondragover="allowDrop(event)"
      >
        <p>Skill Row</p>
      </div>
      <div class="deckBox" id="trashDeck" style="grid-row: 1">
        <p>Trash</p>
        <img
          id="trashcan"
          src="trashcan.jpg"
          ondrop="drop(event, 'trash', trash)"
          ondragover="allowDrop(event)"
        />
      </div>
      <div style="grid-row: 2">
        <button onclick="shuffleArray('traded')">Shuffle</button>
        <button onclick="moveMultiple('traded', 'trader')">Draw</button>
      </div>
      <div class="deckBox" id="intentArea" style="grid-row: 3" data-value="0" >
        <p>Intent Card</p>
      </div>
      <div style="grid-row: 4">
      <button onclick="cycleDeck(intent, 'intent')">></button>
    </div>
      <div
        class="playBox"
        id="playArea"
        style="grid-row: 3"
        ondrop="drop(event, 'play', play)"
        ondragover="allowDrop(event)"
      >
        <p>Play Area</p>
      </div>
      <div class="deckBox" id="resourceArea" style="grid-row: 3">
        <p>Resource Deck</p>
      </div>
      
      <div style="grid-row: 4">
        <button onclick="moveMultiple('play', 'disc')">Discard All</button>
      </div>
      <div style="grid-row: 4">
        <button onclick="cycleDeck(resource, 'resource')">></button>
      </div>
      <div
        class="deckBox"
        id="drawDeck"
        style="grid-row: 5"
        draggable="true"
        ondrag="drag(event, 0, 'draw')"
        ondragover="allowDrop(event)"
        ondrop="drop(event, 'draw', deck)"
      >
        <p>Draw Deck</p>
        <p id="emptypoop" style="color:red; font-size:18px; display:none"><br /><br />EMPTY</p>
      </div>
      <div
        class="playBox"
        id="handArea"
        style="grid-row: 5"
        ondrop="drop(event, 'hand', hand)"
        ondragover="allowDrop(event)"
      >

        <p>Hand</p>
      </div>
      <div
        class="emptyBox"
        id="discardArea"
        style="grid-row: 5"
        ondrop="drop(event, 'disc', discard)"
        ondragover="allowDrop(event)"
      >
        <p>Discard Deck</p>
      </div>
      <div style="grid-row: 6; margin-right: 30px">
        <button onclick="shuffleArray('main')">Shuffle</button>
        <button onclick="moveMultiple('draw', 'hand')">Draw</button>
        
      </div>
      <div style="grid-row: 6">
        <button onclick="moveMultiple('hand', 'disc')">Discard All</button>
      </div>
      <div style="grid-row: 6">
        <button onclick="shuffleArray('discard')">Shuffle</button>
        <button onclick="cycleDeck(discard, 'discard')" value="0">></button>
        
      </div>

      
    </div>
    <p>
      <b>Deck</b
    </p>
    <div id="deckpoop">
      <!-- Cards will be displayed here -->
    </div>
    <p>
      <b>Discard</b>
    </p>
    <div id="discardpoop"></div>
    <p>
      <b>Hand</b>
    </p>
    <div id="handpoop">ANYTHING?</div>
    <div id="sheetpoop">ANYTHING? at all?</div>
    <script>
      let master = [
        {
          id: "1001",
          title: "SWIFT",
          cardtext: "Move one tile, bypass Armor, increase Armor",
          image: "shoeg",
          used: "no",
        },
        {
          id: "1002",
          title: "BRUTE",
          cardtext: "Increase damage, Shove, Climb",
          image: "bruteb",
          used: "no",
        },
        {
          id: "1003",
          title: "CHARM",
          cardtext: "Goad, Intimidate, Bolster ally",
          image: "bursty",
          used: "no",
        },
        {
          id: "1004",
          title: "SMART",
          cardtext: "Search, Analyze, Hide, Recall",
          image: "eyeo",
          used: "no",
        },
        {
          id: "2001",
          title: "WAR SHARD",
          cardtext: "Conjure a Weapon and/or Shield & add active Hunger to Damage",
          image: "line",
          used: "no",
        },
        {
          id: "2002",
          title: "Minor Shard",
          cardtext: "This will likely have a benefit tied to the physical changes tied to the Shard",
          image: "line",
          used: "no",
        },
        {
          id: "2003",
          title: "Hunger",
          cardtext: "Persistent (counts against Hand/Play area limit). If discarded, add 1 Promise",
          image: "line",
          used: "no",
        },
        {
          id: "3001",
          title: "Sword",
          cardtext: "2 + Active Brute to Damage",
          image: "swordr",
          used: "no",
        },
        {
          id: "3002",
          title: "Dagger",
          cardtext: "Add Active Swift to damage",
          image: "swordr",
          used: "no",
        },
        {
          id: "3003",
          title: "Shield",
          cardtext: "+2 Armor",
          image: "shieldb",
          used: "no",
        },
        {
          id: "3004",
          title: "Longbow",
          cardtext: "1 dmg 2 tiles away or 2 dmg 1 tile away, requires 1 Brute to activate",
          image: "line",
          used: "no",
        },
        {
          id: "4001",
          title: "Intimidating Stance",
          cardtext: "Spend Brute or Charm for Intimidation",
          image: "line",
          used: "no",
        },
        {
          id: "4002",
          title: "Spot an Opening",
          cardtext: "Spend Swift or Smart to ignore armor.",
          image: "line",
          used: "no",
        },
        {
          id: "4003",
          title: "All Out Sprint",
          cardtext: "Spend Swift or Brute for movement.",
          image: "line",
          used: "no",
        },
        {
          id: "4004",
          title: "All Out Attack",
          cardtext: "Spend Swift or Brute to increase damage.",
          image: "line",
          used: "no",
        },
        {
          id: "4005",
          title: "Word Spinner",
          cardtext: "Can spend Smart or Charm on social manipulation.",
          image: "line",
          used: "no",
        },
        {
          id: "4006",
          title: "Stealthy",
          cardtext: "Spend Smart of Swift for Hiding.",
          image: "line",
          used: "no",
        },
        {
          id: "5001",
          title: "Divine Burst",
          cardtext: "Shard must be Active. Do Active Hunger in dmg to all in your tile.",
          image: "line",
          used: "no",
        },
        {
          id: "5002",
          title: "Angrify",
          cardtext: "2 Charm. Enemy focuses only on you until the next round.",
          image: "line",
          used: "no",
        },
        {
          id: "5003",
          title: "Best Buds",
          cardtext: "2 Charm. Convince a friendly target to do 1 simple action as long as it not obviously harmful.",
          image: "line",
          used: "no",
        },
        {
          id: "5004",
          title: "Minor Improvisation",
          cardtext: "1 Smart. Draw 1 Card, then Discard 1 Card.",
          image: "line",
          used: "no",
        },
        {
          id: "5005",
          title: "Implied Threat",
          cardtext: "1 Charm. Add Active Weapon rating to Intimidation check.",
          image: "line",
          used: "no",
        },
        {
          id: "5006",
          title: "Hang On!",
          cardtext: "1 Swift/1 Brute. You jump onto the back of a huge creature and make an attack. If it hits, you move with the creature until shaken off",
          image: "line",
          used: "no",
        },
        {
          id: "5007",
          title: "Falling with Style",
          cardtext: "1 Swift. You can descend a steep hill, tree, wall, or cliff in a single move as long as there are hand holds.",
          image: "line",
          used: "no",
        },
        {
          id: "5008",
          title: "Channel",
          cardtext: "Shard. Spend Hunger to create a relevant effect in battle. Promise increases are doubled if above the Shard's rating.",
          image: "line",
          used: "no",
        },
        {
          id: "5009",
          title: "Sanguinology",
          cardtext: "Hunger. Per spent Hunger, ask one question about the hearts or blood of creatures in sight.",
          image: "line",
          used: "no",
        },
        {
          id: "5010",
          title: "Flashback",
          cardtext: "You've seen this before. Add +2 to an action that is relevant to something in your past.",
          image: "line",
          used: "no",
        },
        {
          id: "5011",
          title: "Bend Bars/ Lift Gates",
          cardtext: "3 Brute. Do a feat of strength others would marvel at. Spend Hunger for truly inhuman feats.",
          image: "line",
          used: "no",
        },
        {
          id: "5012",
          title: "Mind your Surroundings",
          cardtext: "1 Brute/1Smart. Add Cover rating in damage to a successful Shove.",
          image: "line",
          used: "no",
        },
        {
          id: "5013",
          title: "Hunger Pangs",
          cardtext: "WARNING-If this card is visible at the end of a round, take damage equal to your Active Hunger",
          image: "line",
          used: "no",
        },
        {
          id: "5014",
          title: "Opportunist",
          cardtext: "2 Smart. If an enemy is forced to discard a card, draw a card.",
          image: "line",
          used: "no",
        },
        {
          id: "6001",
          title: "Terrifying",
          cardtext: "Brute. Players cannot take offensive actions until discarding cards equal to Active Brute.",
          image: "line",
          used: "no",
        },
        {
          id: "6002",
          title: "Shard Radar",
          cardtext: "Smart. Players lose Armor equal to highest Shard rating.",
          image: "line",
          used: "no",
        },
        {
          id: "6003",
          title: "Terrifying",
          cardtext: "Brute. Players cannot take offensive actions until discarding cards equal to Active Brute.",
          image: "line",
          used: "no",
        },
        {
          title: "Slip Up",
          cardtext: "Cost: 1 Smart. Ignore 1 armor.",
          image: "line",
          used: "no",
        },
        {
          title: "Uneven Terrain",
          cardtext: "If you spend Swift to move, take 1 damage.",
          image: "line",
          used: "no",
        },
        {
          title: "Turtle Up",
          cardtext: "Enemy takes cover if any available.",
          image: "line",
          used: "no",
        },
        {
          title: "Distraction",
          cardtext: "Spend Charm to lower enemy's Smart rating.",
          image: "line",
          used: "no",
        },
        {
          title: "Relocate",
          cardtext: "Enemy moves to new location.",
          image: "line",
          used: "no",
        },
      ];
      var deck = []
      var discard = [];
      var hand = [];
      let trash = [];
      var play = [];
      let traded = ["5001", "5002", "5003", "5004", "5005", "5006", "5007", "5008", "5009", "5010", "5011", "5012", "5013", "5014"];
      let trader = [];
      let intent = ["4001", "4002", "4003", "4004", "4005", "4006"];
      let resource = ["3001", "3002", "3003", "3004" ]
      var activeCard = [];
      var activePos = [];
      var circle =
        "circle-empty.jpg";
      var filled =
        "circle-filled.jpg";
      stats = ["bru", "swi", "sma", "cha", "bod", "min", "hun"]
      window.addEventListener("click", getInfo())

   
      window.onload = function () {
        loadThings()
        shuffleArray("traded")
      };


      function loadThings() {
        
        let len = stats.length;
      for (let i = 0; i < len; i++) {
        sta = stats[i];
        DotifyAll(sta);
      }
      changeDeck();
      }

      function changeDeck() {
        deck = ["2001", "2002"];
        sl = ["bru", "swi", "sma", "cha", "hun"]
        len = sl.length;
        for (let i = 0; i < len; i++) {
          newb = sl[i];
          newNum = newb + "num";
          elem1 = document.getElementById(newNum);
          val = elem1.value;
          for (let i = 0; i < val; i++){
            if (newb == "bru") deck.push("1002");
            else if (newb == "swi") deck.push("1001");
            else if (newb == "sma") deck.push("1004");
            else if (newb == "cha") deck.push("1003");
            else if (newb == "hun") deck.push("2003");
          }
        }
        shuffleArray('main')
      }

      function HealthMax() {
        maxId = document.getElementById("maxHealth");
        bodH = document.getElementById("bodnum");
        bodVal = Number(bodH.value);
        maxH = bodVal + 5;
        textH = " /" + maxH;
        maxId.innerText = textH;
      }

      function NumberMe(stat) {
        let numId = stat + "num";
        let val = document.getElementById(numId).value;
        ClickMe(stat, val);
      }

      function ClickMe(stat, dot) {
        let dotId = stat + dot;
        let demog = document.getElementById(dotId);
        let numId = stat + "num";
        let dotFixed = Number(dot);
        let numStat = document.getElementById(numId);
        statMin = numStat.min;
        statMax2 = Number(numStat.max) + 1;
        let currentVal = numStat.value;
        for (i = 1; i < statMax2; i++) {
          if (statMin == 1 || currentVal != 1 || dotFixed != 1) {
          numStat.value = dotFixed;
          let newImg = stat + i;
          if (i > dotFixed) document.getElementById(newImg).src = circle;
          else if (i <= dotFixed) document.getElementById(newImg).src = filled;
        } else  {
          numStat.value = 0;
          let newImg = stat + i;
          document.getElementById(newImg).src = circle;
        }
        }
      }

      function DotifyAll(attName) { 
      let parId = attName + "Par";
      let parPar = document.getElementById(parId);
      let statNum = attName + "num";
      let numId = document.getElementById(statNum)
      let text6 = " ";
      max = numId.max;
      for (i = 1; i <= max; i++) {
        text6 +=
          "<input class='aCir' type='image' src='circle-empty.jpg' id='" +
          attName +
          i +
          "' onclick=\"ClickMe('" +
          attName +
          "', " +
          i +
          ')" />';
      }
    
      parPar.innerHTML = text6;
      document.getElementById(statNum).dispatchEvent(new Event("input"));
    }

      function resolvePromise() {
        let pNum = document.getElementById("promnum");
        let pDie = document.getElementById("promdie");
        pVal = pNum.value;
        dieVal = pDie.value;
        if (dieVal < 12) nextDie = Number(dieVal) + 2;
        else if (dieVal >= 12) nextDie = Number(20);
        nuVal = pVal - dieVal;
        if (nuVal > -1) {
          
          if (dieVal < 13) {
            pDie.value = nextDie;
            pNum.value = nuVal;
            resolvePromise();
          }
        
          else if (dieVal = 20) {
            alert("Your Shard has taken over!");
            nextDie = Number(4);
          }
        } 
        else if (nuVal <= -1) {
          dieRoll = Math.floor(Math.random() * dieVal) + 1;
          alert( "Die Roll: " + dieRoll + " on a d" + dieVal + " with a Promise number of " + pVal);
          if (dieRoll <= pVal) {
            if (dieVal < 12) {
              nextDie = Number(dieVal) + 2;
            }
            else if (dieVal == 12) {
              nextDie = Number(20);
            }
            else if (dieVal == 20) {
              alert("Your Shard has taken over!");
              nextDie = Number(4);
            }

            pDie.value = nextDie;
            pNum.value = 0;

          }
          else pNum.value = 0;
        }
      }

      function changeWar(){
        let elem = document.getElementById("warshard");
        let elem2 = document.getElementById("warAbility");
        let elem3 = document.getElementById("wartrait");
        let elem4 = document.getElementById("traittext");
        abil = elem.value;
        elem2.innerText = abil;
        trait = elem3.value;
        elem4.innerText = trait;
      }

      function emptyDeck(boop) {
        idName = boop + "Deck";
        fullEmpty = document.getElementById(idName);
        fullEmpty.setAttribute("class", "emptyBox");
        return
      }

      function getInfo() {
        di = document.getElementById("discardpoop");
        if (discard == "") di.innerText = "empty";
        else di.innerText = discard;
        de = document.getElementById("deckpoop");
        if (deck == "") de.innerText = "empty";
        else de.innerText = deck;
        ha = document.getElementById("handpoop");
        if (hand == "") ha.innerText = "empty";
        else ha.innerText = hand;
      }

      function toggleSheet(action) {
        mat = document.getElementById("mattBoxx")
        elem2 = document.getElementById("statButt");
        elem = document.getElementById("statSheet");
        if (action == "close") {
        elem.style["display"] = "none";
        elem2.style["display"] = "block";
        mat.classList.remove("grayout")
        }
        else if (action == "open") {
        elem.style["display"] = "block";
        elem2.style["display"] = "none";
        mat.classList.add("grayout");
        }
      }

      function createDeck(ogArray) {
        
        let newArray = [];
        ogArray.forEach((card) => {
        pos = Number(master.findIndex(e => e.id === card));
        newCard = master[pos];
        newArray.push(newCard);
        }
        )
        return newArray
      }


      function cycleDeck(array, areaId) {
        cycleArray = [];
        len = array.length 
        areaFull = areaId + "Area";
        area = document.getElementById(areaFull);
        if (len == 0) {
          area.innerHTML = "";
          return
        }
        val = area.getAttribute('data-value');
        cardPos = Number(val);
        newVal = cardPos + 1;
        if (newVal == len) newVal = 0;
        area.setAttribute('data-value', newVal);
        newCard = array[cardPos];
        cycleArray.push(newCard);
        displayHand(areaId, cycleArray);
      }

      function displayHand(area, dArray) {
        areaId = area + "Area";
        newArray = createDeck(dArray);
        cardList = newArray;
        const handElement = document.getElementById(areaId);
        handElement.innerHTML = "";
        cardList.forEach((card) => {
          let cardPos = Number(cardList.indexOf(card));
          const cardElement1 = document.createElement("div");
          cardElement1.className = "column";
          const cardElement2 = document.createElement("div");
          cardElement2.className = "card";
          cardElement2.style["width"] = "150px";
          cardElement2.style["background-color"] = "white";
          const cardElement3 = document.createElement("div");
          cardElement3.className = "container";
          cardElement3.innerText = card.title;
          cardElement3.style["text-transform"] = "uppercase";
          cardElement3.style["font-weight"] = "bold";
          cardElement3.style["text-align"] = "center";
          cardElement3.style["padding"] = "5px";
          const cardElement4 = document.createElement("img");
          cardElement4.className = "container";
          cardElement4.id = "id" + cardPos;
          cardElement4.src = card.image + ".jpg";
          cardElement4.style["width"] = "120px";
          cardElement2.draggable = "true";
          cardElement2.addEventListener("dragstart", function () {
            drag(event, cardPos, area);
          });
          cardElement4.addEventListener("click", function () {
            if (card.used == "no") {
              cardElement4.classList.add("grayout");
              card.used = "yes";
            } else if (card.used == "yes") {
              cardElement4.classList.remove("grayout");
              card.used = "no";
            }
          });
          const cardElement5 = document.createElement("div");
          cardElement5.className = "container";
          cardElement5.innerText = card.cardtext;
          cardElement5.style["padding"] = "10px";
          cardElement2.appendChild(cardElement3);
          cardElement2.appendChild(cardElement4);
          cardElement2.appendChild(cardElement5);
          cardElement1.appendChild(cardElement2);
          handElement.appendChild(cardElement1);
        });
      }

      function shuffleArray(array) {
        if (array == "main") {
          let unshuffled = deck;
          deck = unshuffled
            .map((value) => ({ value, sort: Math.random() }))
            .sort((a, b) => a.sort - b.sort)
            .map(({ value }) => value);
            getInfo();
        } else if (array == "discard") {
          let unshuffled = deck.concat(discard);
          deck = unshuffled
            .map((value) => ({ value, sort: Math.random() }))
            .sort((a, b) => a.sort - b.sort)
            .map(({ value }) => value);
          discard = [];
          poop = document.getElementById('discardArea')
          poop.setAttribute("class", "emptyBox");
          fullEmpty = document.getElementById("drawDeck");
          fullEmpty.setAttribute("class", "deckBox");
          getInfo();
        } else if (array == "traded") {
          let unshuffled = traded.concat(trash);
          traded = unshuffled
            .map((value) => ({ value, sort: Math.random() }))
            .sort((a, b) => a.sort - b.sort)
            .map(({ value }) => value);
          trash = [];
          fullEmpty = document.getElementById("tradedDeck");
          fullEmpty.setAttribute("class", "deckBox");
          getInfo();
        }
      }


      function moveMultiple(sourceId, destId) {
        destArray = getSource(destId);
        sourceArray = getSource(sourceId);
        emp = document.getElementById("emptypoop");
        len = sourceArray.length;
        lenD = destArray.length;

            if (sourceId == "draw" || sourceId == "traded") {
              rawNum = 5 - lenD;
              if (rawNum >= len) {
                newNum = len;
                emptyDeck(sourceId);
              }
              else newNum = rawNum;

              for (i=0; i < newNum; i++) {
            drag(event, 0, sourceId);
            drop(event, destId, destArray);
              }
            }
            else {
            len2 = sourceArray.length;  
            for (i=0; i < len2; i++) {
            drag(event, 0, sourceId);
            drop(event, destId, destArray);
            }
            }
          
        }


      function moveCard(dest, source) {
        sourcePos = activePos[0];
        movedCard = source[sourcePos];
        dest.push(movedCard);
        source.splice(sourcePos, 1);
        displayHand("hand", hand);
        displayHand("play", play);
        displayHand("trader", trader);
        if (discard.length == 0) {
          let elem = document.getElementById("discardArea");
          elem.setAttribute("class", "emptyBox");
        }
        else if (discard.length > 0) {
          let elem = document.getElementById("discardArea");
          elem.setAttribute("class", "deckBox");
        }
        if (deck.length == 0) {
          let elem = document.getElementById("drawDeck");
          elem.setAttribute("class", "emptyBox");
        }
        else if (deck.length > 0) {
          let elem = document.getElementById("drawDeck");
          elem.setAttribute("class", "deckBox");
        }

      }

      function allowDrop(ev) {
        ev.preventDefault();
      }

      function drag(ev, cardPos, source1) {
        if (source1 == "intent" || source1 == "resource" || source1 == "discard") alert("I'm sorry Dave. I'm afraid I can't do that.");
        else {
        let poop = document.getElementById("deckpoop");
        let len = deck.length;
        activePos.push(cardPos);
        activeCard.push(source1);
        }
      }

      function drop(ev, dest, array) {
        ev.preventDefault();
        source = activeCard[0];
        position = activePos[0];
        sourceArray = getSource(source);
        len = sourceArray.length;
        
        if (sourceArray == deck && len == 0 || sourceArray == traded && len == 0) {
          alert("The deck is empty");
          activeCard = [];
          activePos = [];
          return
        }
        else {
        moveCard(array, sourceArray);
        activeCard = [];
        activePos = [];
        getInfo();
        }
      }

      function getSource(fluff) {
        if (fluff == "draw") return deck;
        else if (fluff == "hand") return hand;
        else if (fluff == "trash") return trash;
        else if (fluff == "disc") return discard;
        else if (fluff == "trader") return trader;
        else if (fluff == "traded") return traded;
        else if (fluff == "play") return play;
      }

      function SavingStuff() {
      let obj1 = document.querySelectorAll(".attrib, .sav, .writing");;
      let array1 = [];
      let len = obj1.length;
      for (let i = 0; i < len; i++) {
        statName = obj1[i].id;
        statVal = obj1[i].value;
        statVal1 = statVal.replaceAll(":", "-")
        statVal2 = statVal1.replaceAll(",", ";");
        statPair = statName+":" + statVal2;
        array1.push(statPair);
      }
      document.getElementById("saveField").value = array1;
      }

      function LoadSave() {
      let field = document.getElementById("saveField");
      let data = field.value;
      let array2 = data.split(",");
      let len = array2.length;
      let newArray2 = array2[0].split(":")
      for (let i = 0; i < len; i++) {
        pair = array2[i];
        newArray = pair.split(":");
        statId = newArray[0];
        statnum = newArray[1];
        document.getElementById(statId).value = statnum;
        document.getElementById(statId).dispatchEvent(new Event("input"));
      }
    }

    </script>
  </body>
</html>
